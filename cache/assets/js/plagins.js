define(["jquery"],function(h){"use strict";function e(t){this.$element=h(t),this.autoResize=!1,this.bottom=10,this.min=200,this.initialization()}e.prototype={initialization:function(){this.getParams(),this.refresh(),this.resize()},getParams:function(){this.autoResize=this.$element.data("auto-height-resize"),this.bottom=this.$element.data("auto-height-bottom")?this.$element.data("auto-height-bottom"):this.bottom,this.min=this.$element.data("auto-height-min")?this.$element.data("auto-height-min"):this.min},resize:function(){this.autoResize&&h(window).on("resize",h.proxy(function(){this.refresh()},this))},refresh:function(){this.height()},height:function(){var t=h(window).height()-this.$element.offset().top-this.bottom;t<this.min&&(t=this.min),this.$element.height(t)}},h.fn.autoHeight=function(t){return this.each(function(){h(this).data("initAutoHeight")||h(this).data("initAutoHeight",new e(this))})};var i=function(t){this.options=h.extend({},i.Default,t),this.$element=document.querySelector("#"+this.options.scrollName),this.$element||(this.$element=document.createElement("span"),this.$element.setAttribute("id",this.options.scrollName)),this.animation={animIn:"show",animOut:"hide",animSpeed:0},this.scrollDis,this.scrollTarget,this.triggerVisible,this.init()};i.Default={scrollName:"scrollUp",scrollDistance:300,scrollFrom:"top",scrollSpeed:300,easingType:"linear",animation:"fade",animationSpeed:200,scrollTarget:!1,scrollText:!1,scrollTitle:!1,zIndex:1e3},i.prototype={init:function(){switch(this.options.scrollText&&(this.$element.innerHTML=this.options.scrollText),this.options.scrollTitle&&this.$element.setAttribute("title",this.options.scrollTitle),this.$element.setAttribute("style","display:none; position:fixed; z-index:"+this.options.zIndex+"; cursor:pointer"),h(this.$element).appendTo(document.body),this.options.animation){case"fade":this.animation={animIn:"fadeIn",animOut:"fadeOut",animSpeed:this.options.animationSpeed};break;case"slide":this.animation={animIn:"slideDown",animOut:"slideUp",animSpeed:this.options.animationSpeed}}this.setScrollDis(),this.scroll(),h(window).on("scroll",h.proxy(this.scroll,this)),this.options.scrollTarget?"number"==typeof this.options.scrollTarget?this.scrollTarget=this.options.scrollTarget:"string"==typeof this.options.scrollTarget&&(this.scrollTarget=Math.floor(h(this.options.scrollTarget).offset().top)):this.scrollTarget=0,h(this.$element).on("click",h.proxy(this.click,this))},setScrollDis:function(){"top"===this.options.scrollFrom?this.scrollDis=this.options.scrollDistance:this.scrollDis=h(document).height()-h(window).height()-this.options.scrollDistance},scroll:function(){h(window).scrollTop()>this.scrollDis?this.triggerVisible||(h(this.$element).stop(!0,!0)[this.animation.animIn](this.animation.animSpeed),this.triggerVisible=!0):this.triggerVisible&&(h(this.$element).stop(!0,!0)[this.animation.animOut](this.animation.animSpeed),this.triggerVisible=!1)},click:function(t){t.preventDefault();var e=this.scrollTarget;h(window).one("wheel.un.scrollup",function(){h("html,body").stop(),h(document).off("touchstart.un.scrollup")}),h(document).one("touchstart.un.scrollup",function(){h("html,body").stop(),h(window).off("wheel.un.scrollup")}),h("html,body").animate({scrollTop:e},this.options.scrollSpeed,this.options.easingType,function(){h(window).off("wheel.un.scrollup"),h(document).off("touchstart.un.scrollup")})}};function s(t){this.$element=h(t),this.$element.length&&!this.$element.data("initAutomaxwidth")&&(this.$element.data("initAutomaxwidth",!0),this._width=this.$element.width(),this.$left=this.$element.find('[data-auto-maxwidth="left"]'),this.$right=this.$element.find('[data-auto-maxwidth="right"]'),this.$content=this.$element.find('[data-auto-maxwidth="content"]'),this.width=0,this.resizeTimer=null,this.initialization())}s.prototype={initialization:function(){this.setWidth(),h(window).on("resize",h.proxy(this.onResize,this))},setWidth:function(){this.width=this._width,this.$left.length&&(this.width=this._width-this.$left.outerWidth(!0)),this.$right.length&&(this.width=this._width-this.$right.outerWidth(!0)),this.$content.css("max-width",this.width)},onResize:function(){window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(h.proxy(this.resize,this),200)},resize:function(){this._width!==this.$element.width()&&(this._width=this.$element.width(),this.setWidth())}},h.fn.autoMaxWidth=function(t){return this.each(function(){h(this).data("initAutoMaxWidth")||h(this).data("initAutoMaxWidth",new s(this))})};function n(t){this.$element=h(t),this.$content=this.$element.find('[data-readmore="content"]'),this.$element.length&&this.$content.length&&!this.$element.data("initReadmore")&&(this.$container=h("<div />",{class:"read-more"}),this.$btn=h("<a />",{href:"#",class:"read-more-link",role:"button"}),this.$container.append(this.$btn),this._height=this.$element.height(),this.resizeTimer=null,this.initialization())}n.prototype={initialization:function(){this.$element.data("readmore-btn-class")&&this.$btn.addClass(this.$element.data("readmore-btn-class")),this.setBtnMore(),h(window).on("resize",this.onResize.bind(this))},setBtnMore:function(){this._height<this.$content.height()?(this.$element.attr("data-read-more-init")||this.$element.attr("data-read-more-init",!0),this.$element.hasClass("read-more-open")?this.$btn.html(this.$element.data("readmore-btn-hide")):this.$btn.html(this.$element.data("readmore-btn-show")),this.$element.after(this.$container),this.$btn.off("click"),this.$btn.on("click",this.eventBtn.bind(this))):(this.$element.addClass("read-more-open"),this.$btn.remove())},eventBtn:function(t){t.preventDefault(),this.$element.hasClass("read-more-open")?(this.$element.attr("aria-expanded",!1),this.$element.removeClass("read-more-open"),this.$btn.html(this.$element.data("readmore-btn-show"))):(this.$element.data("readmore-btn-hide")?this.$btn.html(this.$element.data("readmore-btn-hide")):this.$btn.remove(),this.$element.attr("aria-expanded",!0),this.$element.addClass("read-more-open"))},onResize:function(){window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(h.proxy(this.resize,this),200)},resize:function(){this._height!==this.$element.height()&&(this.$element.hasClass("read-more-open")||(this._height=this.$element.height()),this.setBtnMore())}},h.fn.readMore=function(t){return this.each(function(){h(this).data("initReadmore")||h(this).data("initReadmore",new n(this))})};function o(t){this.$element=h(t),this.$parent=this.$element.parent(),this.$content=null,this.fancybox=h.fancybox,this.options=this.fancybox.defaults,this.$bg=h(this.options.baseTpl),this.$spinner=h(this.options.spinnerTpl),this.processing=!1}o.prototype={init:function(t){this.fancybox.defaults.infobar=!0,this.fancybox.defaults.transitionEffect="slide",this.$element=t?h(t):this.$element,this.isProcessing()||(this.$bg.on("click",h.proxy(function(){this.isProcessing()&&this.hideLoading()},this)),this.$content?this.fancybox.open(this.$content.parent().children(),{},this.$element.index()):this.ajax())},ajax:function(){this.showLoading(),this.setProcessing(!0),h.ajax({url:this.$parent.data("ajax-url"),dataType:"json",method:this.$parent.data("ajax-method"),data:this.$parent.data("ajax-appear-params")}).then(h.proxy(function(t){this.setProcessing(!1),this.hideLoading(),"success"===t.status&&(this.$content=h(t.content).wrap("<div />"),this.fancybox.open(this.$content.parent().children(),{},this.$element.index()))},this)).catch(h.proxy(function(){this.setProcessing(!1),this.hideLoading()},this))},showLoading:function(){h(".fancybox-bg",this.$bg).css("transition-duration",this.options.speed+"ms"),h(this.$spinner).appendTo(this.$bg),this.$bg.hide(),h("body").append(this.$bg),this.$bg.show(),this.$bg.addClass("fancybox-container--ready")},hideLoading:function(){var t=this;this.$bg.removeClass("fancybox-container--ready"),this.$spinner.remove(),window.setTimeout(function(){t.$bg.remove()},this.options.speed)},setProcessing:function(t){this.processing=!0===t},isProcessing:function(){return!0===this.processing}},h(document).on("click","[data-ajaxImageLoad]",function(t){t.preventDefault();var e=h(this).parent();e.data("ajaxImageLoadInit")||e.data("ajaxImageLoadInit",new o(this)),e.data("ajaxImageLoadInit").init(this)}),h.fn.imagesLoaded=function(s){var n=this.find("img"),o=[],s=s;n.each(function(t,e){function i(){o.push(this),s.imageLoaded&&s.imageLoaded(this),o.length==n.length&&s.complete&&s.complete(o)}e.complete||void 0===e.complete?i.call(e):h(e).on("load",i)})},window.toggleClass=function(t){this.$element=h(t),this.$block=h(this.$element.data("toggle-class-block")),this._timeout=null,this.delay=this.$element.data("toggle-class-delay")?this.$element.data("toggle-class-delay"):0,this._processing=!1,this.container=null,this.class={opening:"b-opening",opened:"b-opened",begin:"b-begin"},this.text={show:"",hide:""},this.icon={current:"",next:""},this._events={general:{start:"toggle_class.start",finish:"toggle_class.finish",before:"toggle_class.before",after:"toggle_class.after"},open:{start:"toggle_class.open.start",finish:"toggle_class.open.finish",before:"toggle_class.open.before",after:"toggle_class.open.after"},close:{start:"toggle_class.close.start",finish:"toggle_class.close.finish",before:"toggle_class.close.before",after:"toggle_class.close.after"}}},toggleClass.prototype={init:function(){var t,e={relatedTarget:this};if(this.icon.current=this.$element.data("current-icon"),this.icon.next=this.$element.data("icon"),this.text.show=this.$element.data("show"),this.text.hide=this.$element.data("hide"),this.icon.current&&this.icon.next&&this.$element.find(this.options.icon.prefix).replaceWith(this.isOpen()?this.icon.current:this.icon.next),this.text.show&&this.text.hide&&this.$element.text(this.isOpen()?this.text.show:this.text.hide),this.isOpen()){if(this.$element.trigger(t=h.Event(this._events.close.start,e)),t.isDefaultPrevented())return;if(this.$element.trigger(t=h.Event(this._events.general.start,e)),t.isDefaultPrevented())return;this.setProcessing(!0),this.$element.trigger(h.Event(this._events.close.before,e)),this.$element.trigger(h.Event(this._events.general.before,e)),0<this.delay?(clearTimeout(this._timeout),this._timeout=setTimeout(h.proxy(this.close,this),this.delay+80)):this.close()}else{if(this.$element.trigger(t=h.Event(this._events.open.start,e)),t.isDefaultPrevented())return;if(this.$element.trigger(t=h.Event(this._events.general.start,e)),t.isDefaultPrevented())return;this.setProcessing(!0),this.$element.trigger(h.Event(this._events.open.before,e)),this.$element.trigger(h.Event(this._events.general.before,e)),0<this.delay?(clearTimeout(this._timeout),this._timeout=setTimeout(h.proxy(this.open,this),this.delay+80)):this.open()}},open:function(){var t={relatedTarget:this};this.$element.trigger(h.Event(this._events.open.after,t)),this.$element.trigger(h.Event(this._events.general.after,t)),this.setProcessing(!1),this.$block.addClass(this.class.opened),this.$element.trigger(h.Event(this._events.open.finish,t)),this.$element.trigger(h.Event(this._events.general.finish,t))},close:function(){var t={relatedTarget:this};this.$element.trigger(h.Event(this._events.close.after,t)),this.$element.trigger(h.Event(this._events.general.after,t)),this.setProcessing(!1),this.$block.removeClass(this.class.begin),this.$element.trigger(h.Event(this._events.close.finish,t)),this.$element.trigger(h.Event(this._events.general.finish,t))},setProcessing:function(t){this._processing=!0===t,!0!==t||this.isOpen()?!0===t&&this.isOpen()&&(window.setTimeout(h.proxy(function(){this.$block.removeClass(this.class.opening)},this),30),this.$block.removeClass(this.class.opened)):(this.$block.addClass(this.class.begin),window.setTimeout(h.proxy(function(){this.$block.addClass(this.class.opening)},this),30))},isProcessing:function(){return!0===this._processing},isOpen:function(){return this.$block.hasClass(this.class.opened)}},h(document).on("click","[data-toggle-class]",function(){h(this).data("toggleClassInit")?h(this).data("toggleClassInit").isProcessing()||h(this).data("toggleClassInit").init():(h(this).data("toggleClassInit",new toggleClass(this)),h(this).data("toggleClassInit").init())}).on("toggle_class.before",function(t){var e=t.relatedTarget;e.$block.length&&e.$block.data("initAutoHeight")&&e.$block.is(":visible")&&(e.$block.data("initAutoHeight").refresh(),e.$block.find("[data-auto-height]").each(function(){h(this).data("initAutoHeight")&&h(this).data("initAutoHeight").refresh()}))}),h(function(){new i({scrollName:"scrollUp",animation:"fade",scrollTrigger:!0,scrollDistance:1e3})})});